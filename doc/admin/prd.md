# 资产管理系统后台管理平台 (Cola Admin) 产品需求文档

| 文档版本 | 修改日期 | 修改人 | 备注 |
| :--- | :--- | :--- | :--- |
| v1.0 | 2025-12-20 | AI Assistant | 初始版本，定义管理后台核心功能 |

## 1. 产品概述 (Overview)

### 1.1 背景
随着 Cola Finance 系统的多用户化和功能复杂化，需要一个独立的管理界面来辅助系统管理员 (Admin) 监控系统运行状态、管理用户权限以及调优系统参数（如爬取频率）。

### 1.2 核心价值
- **运维可视化**：将系统日志、任务状态、API 调用情况可视化，降低运维门槛。
- **安全管控**：精细化管理用户权限，防止恶意注册或滥用。
- **配置热更新**：无需重启服务即可动态调整爬取策略和系统参数。

---

## 2. 用户角色 (Roles)

| 角色 | 权限描述 |
| :--- | :--- |
| **Super Admin** (超级管理员) | 拥有系统所有权限，包括创建/删除管理员、修改核心系统参数。 |
| **Operator** (运维人员) | 可以查看日志、管理普通用户状态、手动触发任务，但不可修改敏感配置。 |

---

## 3. 功能需求 (Functional Requirements)

### 3.1 用户与权限管理 (User & RBAC)
- **用户列表**：
  - 查看所有注册用户（ID、用户名、注册时间、最后登录时间、状态）。
  - **操作**：封禁/解封用户、重置密码、查看用户资产概览（仅元数据，不含敏感持仓）。
- **角色管理**：
  - 定义角色（如 Admin, User, VIP）。
  - 分配权限（如 `can_create_group`, `can_use_premium_adapter`）。

### 3.2 系统配置与任务调度 (System Config)
- **爬取策略配置**：
  - **全局间隔**：设置系统默认的爬取间隔（如每 6 小时）。
  - **平台限流**：针对特定平台（如 EastMoney）设置请求速率限制（RPM），防止被封 IP。
  - **超时重试**：配置适配器的超时时间和最大重试次数。
- **任务调度管理**：
  - 查看当前活跃任务（Pending/Running/Failed）。
  - **手动触发**：强制触发某用户的全量数据刷新。
  - **死信队列**：查看并重试失败的任务。

### 3.3 监控与日志 (Monitoring)
- **系统看板**：
  - 当前在线人数、今日API调用次数、今日失败任务数。
  - 系统资源占用（CPU/Memory 概览）。
- **日志查询**：
  - 按用户ID、时间范围、日志级别（INFO/ERROR）搜索系统日志。
  - 重点展示适配器采集失败的详细堆栈信息。

### 3.4 适配器管理 (Adapter Mgmt)
- **状态监控**：
  - 实时显示各平台适配器（EastMoney, IBKR, Schwab）的健康状态（Health Check）。
- **动态开关**：
  - 紧急情况下（如平台接口变更导致大量报错），可一键“熔断”某个适配器，暂停对该平台的调度。

---

## 4. 非功能需求
- **安全性**：管理后台需通过独立的内部网络端口访问，或强制开启 MFA（多因素认证）。
- **操作审计**：管理员的所有敏感操作（如修改配置、封禁用户）必须记录审计日志 (Audit Log)。
